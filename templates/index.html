<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jobb Mapper - Encontre Vagas por Região</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        :root {
            --background-dark: #121212; --surface-color: #1e1e1e; --primary-accent: #3b82f6;
            --primary-accent-hover: #2563eb; --text-primary: #e5e7eb; --text-secondary: #9ca3af;
            --border-color: #374151; --shadow-color: rgba(0, 0, 0, 0.4); --border-radius: 12px;
            --transition-speed: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        * { box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; margin: 0; background-color: var(--background-dark); color: var(--text-primary); }
        .page-wrapper { display: flex; flex-direction: column; min-height: 100vh; }
        header { background-color: var(--surface-color); box-shadow: 0 4px 6px var(--shadow-color); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); z-index: 10; }
        header h1 { margin: 0; color: var(--text-primary); font-size: 1.5rem; font-weight: 600; }
        header h1 span { color: var(--primary-accent); }
        .nav-links { display: flex; align-items: center; gap: 25px; }
        .nav-links a { display: inline-flex; align-items: center; gap: 8px; text-decoration: none; color: var(--text-secondary); font-weight: 500; transition: color var(--transition-speed); cursor: pointer; }
        .nav-links a:hover { color: var(--primary-accent); }
        .nav-links svg { width: 18px; height: 18px; fill: currentColor; }
        .main-content { padding: 2rem; flex-grow: 1; }
        #map { width: 100%; height: 450px; border-radius: var(--border-radius); box-shadow: 0 8px 24px var(--shadow-color); margin-bottom: 2rem; animation: fadeInUp 0.6s var(--transition-speed) forwards; opacity: 0; background-color: #333; }
        .search-container { background-color: var(--surface-color); border-radius: var(--border-radius); box-shadow: 0 8px 24px var(--shadow-color); padding: 2rem; border: 1px solid var(--border-color); animation: fadeInUp 0.8s var(--transition-speed) forwards; opacity: 0; }
        .filters-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem; }
        .filter-group label { font-weight: 500; font-size: 0.9rem; display: block; margin-bottom: 0.5rem; color: var(--text-secondary); }
        .input-text, .select-box { width: 100%; padding: 0.75rem 1rem; font-size: 1rem; border-radius: 8px; border: 1px solid var(--border-color); background-color: var(--background-dark); color: var(--text-primary); }
        .checkbox-group label { display: flex; align-items: center; gap: 10px; font-weight: 400; }
        .button-container { display: flex; justify-content: center; gap: 1rem; margin-top: 1rem; }
        .btn { padding: 0.75rem 1.75rem; font-size: 1rem; font-weight: 600; cursor: pointer; border: none; border-radius: 8px; transition: all var(--transition-speed); }
        .btn:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.2); }
        #searchButton { background-color: var(--primary-accent); color: white; }
        #clearFiltersBtn { background-color: transparent; color: var(--text-secondary); border: 1px solid var(--border-color); }
        #message { margin-top: 1.5rem; color: #f87171; text-align: center; height: 20px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); justify-content: center; align-items: center; }
        .modal-content { background-color: var(--surface-color); padding: 30px; border-radius: var(--border-radius); width: 90%; max-width: 600px; box-shadow: 0 8px 24px var(--shadow-color); position: relative; border: 1px solid var(--border-color); }
        .close-button { color: var(--text-secondary); position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
        .modal-content h2 { color: var(--primary-accent); }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
<div class="page-wrapper">
    <header>
        <h1>Jobb<span>Mapper</span></h1>
        <nav class="nav-links">
            <a id="aboutUsLink">Sobre</a>
            <a id="whatsappShareLink" href="#" target="_blank" rel="noopener noreferrer">
                <svg viewBox="0 0 32 32"><path d=" M19.11 17.205c-.372 0-1.088 1.39-1.518 1.39a.63.63 0 0 1-.63-1.603c0-1.157 1.56-2.137 1.56-2.946a.63.63 0 0 0-.63-.63c-1.39 0-2.527 1.39-2.946 1.39a.63.63 0 0 1-.63-1.603c0-1.157 1.56-2.137 1.56-2.946a.63.63 0 0 0-.63-.63c-1.39 0-2.527 1.39-2.946 1.39a.63.63 0 0 1-.63-1.603c0-1.157 1.56-2.137 1.56-2.946a.63.63 0 0 0-.63-.63c-1.39 0-2.527 1.39-2.946 1.39a.63.63 0 0 1-.63-1.603c0-1.157 1.56-2.137 1.56-2.946a.63.63 0 0 0-.63-.63h-3.39c-1.389 0-2.527 1.138-2.527 2.528v9.112c0 1.389 1.138 2.528 2.527 2.528h3.39a.63.63 0 0 0 .63-.63V15.7c0-1.486 1.56-2.675 1.56-3.864a1.492 1.492 0 0 1 1.492-1.492c.333 0 .63.05.912.14v2.327a.63.63 0 0 0 .63.63c.873 0 1.94-1.39 2.6-1.39a.63.63 0 0 1 .63.63c0 1.157-1.56 2.137-1.56 2.946a.63.63 0 0 0 .63.63c1.39 0 2.527-1.39 2.946-1.39a.63.63 0 0 1 .63 1.603c0 1.157-1.56 2.137-1.56 2.946a.63.63 0 0 0 .63.63c1.39 0 2.527-1.39 2.946-1.39a.63.63 0 0 1 .63 1.603c0 1.157-1.56 2.137-1.56 2.946a.63.63 0 0 0 .63.63c1.39 0 2.527-1.39 2.946-1.39a.63.63 0 0 1 .63 1.603c0 1.157-1.56 2.137-1.56 2.946a.63.63 0 0 0 .63.63h3.39c1.39 0 2.528-1.138 2.528-2.528v-9.112c0-1.389-1.138-2.528-2.528-2.528h-3.39a.63.63 0 0 0-.63.63v4.394" fill="currentColor"></path></svg>
                <span>Compartilhar</span>
            </a>
        </nav>
    </header>

    <div class="main-content">
        <div id="map"></div>
        <div class="search-container">
            <div class="filters-grid">
                <div class="filter-group"><label for="jobTitleInput">Cargo</label><input type="text" id="jobTitleInput" class="input-text" placeholder="Ex: Analista"></div>
                <div class="filter-group"><label for="companyNameInput">Empresa</label><input type="text" id="companyNameInput" class="input-text" placeholder="Ex: Gupy"></div>
                <div class="filter-group"><label for="sortOrderSelect">Ordenar</label><select id="sortOrderSelect" class="select-box"><option value="publishedDate_desc">Mais Recentes</option><option value="publishedDate_asc">Menos Recentes</option></select></div>
                <div class="filter-group"><label>Modelo</label><div class="checkbox-group"><label><input type="checkbox" name="workplace" value="on-site"> Presencial</label><label><input type="checkbox" name="workplace" value="hybrid"> Híbrido</label><label><input type="checkbox" name="workplace" value="remote"> Remoto</label></div></div>
                <div class="filter-group"><label>Opções</label><div class="checkbox-group"><label><input type="checkbox" id="isPwdCheckbox"> Vagas PCD</label></div></div>
            </div>
            <div class="button-container">
                <button id="clearFiltersBtn" class="btn">Limpar</button>
                <button id="searchButton" class="btn">Buscar Vagas</button>
            </div>
            <p id="message"></p>
        </div>
    </div>
</div>

<div id="aboutUsModal" class="modal">
    <div class="modal-content">
        <span id="closeModalBtn" class="close-button">&times;</span>
        <h2>Sobre o Jobb Mapper</h2>
        <p>O Jobb Mapper é sua ponte direta para o mundo das oportunidades de emprego. Nossa missão é simplificar sua busca por vagas, combinando a precisão da localização com a eficiência de filtros avançados.</p>
        <p>Mapeamos as vagas disponíveis no portal Gupy, um dos maiores agregadores de talentos do Brasil, diretamente da sua região de interesse, otimizando seu tempo e conectando você às empresas que estão contratando.</p>
    </div>
</div>

<script>
    // URL do seu backend. Lembre-se de colocar o URL do seu Render/PythonAnywhere aqui quando for publicar.
    const backendApiUrl = '/get-cities-in-view'; 

    // --- LÓGICA DO MAPA COM GEOLOCALIZAÇÃO ---
    const defaultLocation = [-21.25, -48.32];
    const defaultZoom = 10;
    const map = L.map('map');

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                const userLocation = [position.coords.latitude, position.coords.longitude];
                map.setView(userLocation, 12);
            },
            () => {
                map.setView(defaultLocation, defaultZoom);
            }
        );
    } else {
        map.setView(defaultLocation, defaultZoom);
    }
    // --- FIM DA LÓGICA DO MAPA ---

    const searchButton = document.getElementById('searchButton');
    const clearFiltersBtn = document.getElementById('clearFiltersBtn');
    const messageDiv = document.getElementById('message');
    const aboutUsLink = document.getElementById('aboutUsLink');
    const aboutUsModal = document.getElementById('aboutUsModal');
    const closeModalBtn = document.getElementById('closeModalBtn');

    searchButton.addEventListener('click', function() {
        searchButton.disabled = true; clearFiltersBtn.disabled = true;
        searchButton.innerText = 'Buscando...';
        messageDiv.innerText = '';
        const bounds = map.getBounds();
        const searchTerm = document.getElementById('jobTitleInput').value;
        const companyName = document.getElementById('companyNameInput').value;
        const sortOrder = document.getElementById('sortOrderSelect').value;
        const isPwd = document.getElementById('isPwdCheckbox').checked;
        const workplaceTypes = [];
        document.querySelectorAll('input[name="workplace"]:checked').forEach(checkbox => { workplaceTypes.push(checkbox.value); });
        
        fetch(backendApiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ bounds: bounds, term: searchTerm, company: companyName, sort: sortOrder, pwd: isPwd, workplaceTypes: workplaceTypes })
        })
        .then(response => response.json())
        .then(data => {
            if (data.gupy_url) {
                window.open(data.gupy_url, '_blank');
            } else {
                messageDiv.innerText = data.message || 'Ocorreu um erro.';
            }
        })
        .finally(() => {
            searchButton.disabled = false;
            clearFiltersBtn.disabled = false;
            searchButton.innerText = 'Buscar Vagas';
        });
    });

    clearFiltersBtn.addEventListener('click', function() {
        document.getElementById('jobTitleInput').value = '';
        document.getElementById('companyNameInput').value = '';
        document.getElementById('sortOrderSelect').selectedIndex = 0;
        document.getElementById('isPwdCheckbox').checked = false;
        document.querySelectorAll('input[name="workplace"]').forEach(checkbox => { checkbox.checked = false; });
        messageDiv.innerText = '';
    });
    
    aboutUsLink.addEventListener('click', (e) => { e.preventDefault(); aboutUsModal.style.display = 'flex'; });
    closeModalBtn.addEventListener('click', () => { aboutUsModal.style.display = 'none'; });
    window.addEventListener('click', (e) => { if (e.target == aboutUsModal) { aboutUsModal.style.display = 'none'; } });

    function setupWhatsAppLink() {
        const message = encodeURIComponent("Olá! Encontrei esta ferramenta incrível para buscar vagas por mapa. Dê uma olhada!");
        const pageUrl = encodeURIComponent("https://jobbmapper.netlify.app");
        const whatsappUrl = `https://wa.me/?text=${message}%20${pageUrl}`;
        document.getElementById('whatsappShareLink').href = whatsappUrl;
    }
    document.addEventListener('DOMContentLoaded', setupWhatsAppLink);
</script>
</body>
</html>